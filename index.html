<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <link rel="stylesheet" href="node_modules/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="./output.css">
    <script src="node_modules/leaflet/dist/leaflet.js"></script>
</head>
<body class="w-screen h-screen flex">
    <div class="w-[100px] flex flex-col shadow-xl items-center" >
        <div class="h-[50px]">

        </div>
        
        <button id="buttonOne" class="p-1 transition-colors hover:bg-slate-400 my-3 bg-gray-100 rounded-xl">
            <svg width="35px" height="35px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path 
                d="M12.75 9C12.75 8.58579 12.4142 8.25 12 8.25C11.5858 8.25 11.25 8.58579 11.25 9L11.25 11.25H9C8.58579 11.25 8.25 11.5858 8.25 12C8.25 12.4142 8.58579 12.75 9 12.75H11.25V15C11.25 15.4142 11.5858 15.75 12 15.75C12.4142 15.75 12.75 15.4142 12.75 15L12.75 12.75H15C15.4142 12.75 15.75 12.4142 15.75 12C15.75 11.5858 15.4142 11.25 15 11.25H12.75V9Z" 
                fill="#1C274C"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12.0574 1.25H11.9426C9.63424 1.24999 7.82519 1.24998 6.41371 1.43975C4.96897 1.63399 3.82895 2.03933 2.93414 2.93414C2.03933 3.82895 1.63399 4.96897 1.43975 6.41371C1.24998 7.82519 1.24999 9.63422 1.25 11.9426V12.0574C1.24999 14.3658 1.24998 16.1748 1.43975 17.5863C1.63399 19.031 2.03933 20.1711 2.93414 21.0659C3.82895 21.9607 4.96897 22.366 6.41371 22.5603C7.82519 22.75 9.63423 22.75 11.9426 22.75H12.0574C14.3658 22.75 16.1748 22.75 17.5863 22.5603C19.031 22.366 20.1711 21.9607 21.0659 21.0659C21.9607 20.1711 22.366 19.031 22.5603 17.5863C22.75 16.1748 22.75 14.3658 22.75 12.0574V11.9426C22.75 9.63423 22.75 7.82519 22.5603 6.41371C22.366 4.96897 21.9607 3.82895 21.0659 2.93414C20.1711 2.03933 19.031 1.63399 17.5863 1.43975C16.1748 1.24998 14.3658 1.24999 12.0574 1.25ZM3.9948 3.9948C4.56445 3.42514 5.33517 3.09825 6.61358 2.92637C7.91356 2.75159 9.62177 2.75 12 2.75C14.3782 2.75 16.0864 2.75159 17.3864 2.92637C18.6648 3.09825 19.4355 3.42514 20.0052 3.9948C20.5749 4.56445 20.9018 5.33517 21.0736 6.61358C21.2484 7.91356 21.25 9.62177 21.25 12C21.25 14.3782 21.2484 16.0864 21.0736 17.3864C20.9018 18.6648 20.5749 19.4355 20.0052 20.0052C19.4355 20.5749 18.6648 20.9018 17.3864 21.0736C16.0864 21.2484 14.3782 21.25 12 21.25C9.62177 21.25 7.91356 21.2484 6.61358 21.0736C5.33517 20.9018 4.56445 20.5749 3.9948 20.0052C3.42514 19.4355 3.09825 18.6648 2.92637 17.3864C2.75159 16.0864 2.75 14.3782 2.75 12C2.75 9.62177 2.75159 7.91356 2.92637 6.61358C3.09825 5.33517 3.42514 4.56445 3.9948 3.9948Z" fill="#1C274C"/>
                </svg>
        </button>
        <button id="buttonTwo" class="p-1 transition-colors hover:bg-slate-400 my-3 bg-gray-100 rounded-xl">
            <svg width="35px" height="35px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C11.3953 1.25 10.8384 1.40029 10.2288 1.65242C9.64008 1.89588 8.95633 2.25471 8.1049 2.70153L6.03739 3.78651C4.99242 4.33487 4.15616 4.77371 3.51047 5.20491C2.84154 5.65164 2.32632 6.12201 1.95112 6.75918C1.57718 7.39421 1.40896 8.08184 1.32829 8.90072C1.24999 9.69558 1.24999 10.6731 1.25 11.9026V12.0974C1.24999 13.3268 1.24999 14.3044 1.32829 15.0993C1.40896 15.9182 1.57718 16.6058 1.95112 17.2408C2.32632 17.878 2.84154 18.3484 3.51047 18.7951C4.15616 19.2263 4.99241 19.6651 6.03737 20.2135L8.10481 21.2984C8.95628 21.7453 9.64006 22.1041 10.2288 22.3476C10.8384 22.5997 11.3953 22.75 12 22.75C12.6047 22.75 13.1616 22.5997 13.7712 22.3476C14.3599 22.1041 15.0437 21.7453 15.8951 21.2985L17.9626 20.2135C19.0076 19.6651 19.8438 19.2263 20.4895 18.7951C21.1585 18.3484 21.6737 17.878 22.0489 17.2408C22.4228 16.6058 22.591 15.9182 22.6717 15.0993C22.75 14.3044 22.75 13.3269 22.75 12.0975V11.9025C22.75 10.6731 22.75 9.69557 22.6717 8.90072C22.591 8.08184 22.4228 7.39421 22.0489 6.75918C21.6737 6.12201 21.1585 5.65164 20.4895 5.20491C19.8438 4.77371 19.0076 4.33487 17.9626 3.7865L15.8951 2.70154C15.0437 2.25472 14.3599 1.89589 13.7712 1.65242C13.1616 1.40029 12.6047 1.25 12 1.25ZM8.7708 4.04608C9.66052 3.57917 10.284 3.2528 10.802 3.03856C11.3062 2.83004 11.6605 2.75 12 2.75C12.3395 2.75 12.6938 2.83004 13.198 3.03856C13.716 3.2528 14.3395 3.57917 15.2292 4.04608L17.2292 5.09563C18.3189 5.66748 19.0845 6.07032 19.6565 6.45232C19.9387 6.64078 20.1604 6.81578 20.3395 6.99174L17.0088 8.65708L8.50895 4.18349L8.7708 4.04608ZM6.94466 5.00439L6.7708 5.09563C5.68111 5.66747 4.91553 6.07032 4.34352 6.45232C4.06131 6.64078 3.83956 6.81578 3.66054 6.99174L12 11.1615L15.3572 9.48289L7.15069 5.16369C7.07096 5.12173 7.00191 5.06743 6.94466 5.00439ZM2.93768 8.30737C2.88718 8.52125 2.84901 8.76413 2.82106 9.04778C2.75084 9.7606 2.75 10.6644 2.75 11.9415V12.0585C2.75 13.3356 2.75084 14.2394 2.82106 14.9522C2.88974 15.6494 3.02022 16.1002 3.24367 16.4797C3.46587 16.857 3.78727 17.1762 4.34352 17.5477C4.91553 17.9297 5.68111 18.3325 6.7708 18.9044L8.7708 19.9539C9.66052 20.4208 10.284 20.7472 10.802 20.9614C10.9656 21.0291 11.1134 21.0832 11.25 21.1255V12.4635L2.93768 8.30737ZM12.75 21.1255C12.8866 21.0832 13.0344 21.0291 13.198 20.9614C13.716 20.7472 14.3395 20.4208 15.2292 19.9539L17.2292 18.9044C18.3189 18.3325 19.0845 17.9297 19.6565 17.5477C20.2127 17.1762 20.5341 16.857 20.7563 16.4797C20.9798 16.1002 21.1103 15.6494 21.1789 14.9522C21.2492 14.2394 21.25 13.3356 21.25 12.0585V11.9415C21.25 10.6644 21.2492 9.7606 21.1789 9.04778C21.151 8.76412 21.1128 8.52125 21.0623 8.30736L17.75 9.96352V13C17.75 13.4142 17.4142 13.75 17 13.75C16.5858 13.75 16.25 13.4142 16.25 13V10.7135L12.75 12.4635V21.1255Z" fill="#1C274C"/>
                </svg>
        </button>
        <button id="buttonThree" class="p-1 transition-colors hover:bg-slate-400 my-3 bg-gray-100 rounded-xl">
            <svg width="35px" height="35px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M3 1.25C3.41421 1.25 3.75 1.58579 3.75 2V22C3.75 22.4142 3.41421 22.75 3 22.75C2.58579 22.75 2.25 22.4142 2.25 22V2C2.25 1.58579 2.58579 1.25 3 1.25ZM9.46777 4.25H18.5322C18.972 4.24998 19.3514 4.24997 19.6626 4.27818C19.9918 4.30802 20.3178 4.37407 20.625 4.55144C20.967 4.74892 21.2511 5.03296 21.4486 5.375C21.6259 5.68221 21.692 6.00817 21.7218 6.33735C21.75 6.64864 21.75 7.02797 21.75 7.46775V7.53225C21.75 7.97203 21.75 8.35136 21.7218 8.66265C21.692 8.99183 21.6259 9.31779 21.4486 9.625C21.2511 9.96704 20.967 10.2511 20.625 10.4486C20.3178 10.6259 19.9918 10.692 19.6626 10.7218C19.3514 10.75 18.972 10.75 18.5322 10.75H9.46779C9.028 10.75 8.64865 10.75 8.33735 10.7218C8.00817 10.692 7.68221 10.6259 7.375 10.4486C7.03296 10.2511 6.74892 9.96704 6.55144 9.625C6.37407 9.31779 6.30802 8.99183 6.27818 8.66265C6.24997 8.35136 6.24998 7.97201 6.25 7.53223V7.46777C6.24998 7.02799 6.24997 6.64864 6.27818 6.33735C6.30802 6.00817 6.37407 5.68221 6.55144 5.375C6.74892 5.03296 7.03296 4.74892 7.375 4.55144C7.68221 4.37407 8.00817 4.30802 8.33735 4.27818C8.64864 4.24997 9.02799 4.24998 9.46777 4.25ZM8.47274 5.77206C8.2476 5.79246 8.16586 5.82689 8.125 5.85048C8.01099 5.91631 7.91631 6.01099 7.85048 6.125C7.82689 6.16586 7.79246 6.2476 7.77206 6.47275C7.75072 6.7082 7.75 7.01889 7.75 7.5C7.75 7.98111 7.75072 8.2918 7.77206 8.52725C7.79246 8.7524 7.82689 8.83414 7.85048 8.875C7.91631 8.98901 8.01099 9.08369 8.125 9.14952C8.16586 9.17311 8.2476 9.20754 8.47274 9.22794C8.7082 9.24928 9.01889 9.25 9.5 9.25H18.5C18.9811 9.25 19.2918 9.24928 19.5273 9.22794C19.7524 9.20754 19.8341 9.17311 19.875 9.14952C19.989 9.08369 20.0837 8.98901 20.1495 8.875C20.1731 8.83414 20.2075 8.7524 20.2279 8.52725C20.2493 8.2918 20.25 7.98111 20.25 7.5C20.25 7.01889 20.2493 6.7082 20.2279 6.47275C20.2075 6.2476 20.1731 6.16586 20.1495 6.125C20.0837 6.01099 19.989 5.91631 19.875 5.85048C19.8341 5.82689 19.7524 5.79246 19.5273 5.77206C19.2918 5.75072 18.9811 5.75 18.5 5.75H9.5C9.01889 5.75 8.7082 5.75072 8.47274 5.77206ZM9.46779 13.25H15.5322C15.972 13.25 16.3514 13.25 16.6627 13.2782C16.9918 13.308 17.3178 13.3741 17.625 13.5514C17.967 13.7489 18.2511 14.033 18.4486 14.375C18.6259 14.6822 18.692 15.0082 18.7218 15.3373C18.75 15.6486 18.75 16.028 18.75 16.4678V16.5322C18.75 16.972 18.75 17.3514 18.7218 17.6627C18.692 17.9918 18.6259 18.3178 18.4486 18.625C18.2511 18.967 17.967 19.2511 17.625 19.4486C17.3178 19.6259 16.9918 19.692 16.6627 19.7218C16.3514 19.75 15.972 19.75 15.5322 19.75H9.46775C9.02797 19.75 8.64864 19.75 8.33735 19.7218C8.00817 19.692 7.68221 19.6259 7.375 19.4486C7.03296 19.2511 6.74892 18.967 6.55144 18.625C6.37407 18.3178 6.30802 17.9918 6.27818 17.6627C6.24997 17.3514 6.24998 16.972 6.25 16.5322V16.4678C6.24998 16.028 6.24997 15.6486 6.27818 15.3373C6.30802 15.0082 6.37407 14.6822 6.55144 14.375C6.74892 14.033 7.03296 13.7489 7.375 13.5514C7.68221 13.3741 8.00817 13.308 8.33735 13.2782C8.64865 13.25 9.028 13.25 9.46779 13.25ZM8.47275 14.7721C8.2476 14.7925 8.16586 14.8269 8.125 14.8505C8.01099 14.9163 7.91631 15.011 7.85048 15.125C7.82689 15.1659 7.79246 15.2476 7.77206 15.4727C7.75072 15.7082 7.75 16.0189 7.75 16.5C7.75 16.9811 7.75072 17.2918 7.77206 17.5273C7.79246 17.7524 7.82689 17.8341 7.85048 17.875C7.91631 17.989 8.01099 18.0837 8.125 18.1495C8.16586 18.1731 8.2476 18.2075 8.47274 18.2279C8.7082 18.2493 9.01889 18.25 9.5 18.25H15.5C15.9811 18.25 16.2918 18.2493 16.5273 18.2279C16.7524 18.2075 16.8341 18.1731 16.875 18.1495C16.989 18.0837 17.0837 17.989 17.1495 17.875C17.1731 17.8341 17.2075 17.7524 17.2279 17.5273C17.2493 17.2918 17.25 16.9811 17.25 16.5C17.25 16.0189 17.2493 15.7082 17.2279 15.4727C17.2075 15.2476 17.1731 15.1659 17.1495 15.125C17.0837 15.011 16.989 14.9163 16.875 14.8505C16.8341 14.8269 16.7524 14.7925 16.5273 14.7721C16.2918 14.7507 15.9811 14.75 15.5 14.75H9.5C9.01889 14.75 8.7082 14.7507 8.47275 14.7721Z" fill="#1C274C"/>
                </svg>
        </button>
        <div class="grow">

        </div>
        <button class="p-2 transition-colors hover:bg-slate-400 my-3 bg-gray-100 rounded-xl">
            <svg width="30px" height="30px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
               
                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g id="Dribbble-Light-Preview" transform="translate(-380.000000, -2159.000000)" fill="#000000">
                        <g id="icons" transform="translate(56.000000, 160.000000)">
                            <path d="M334,2011 C337.785,2011 340.958,2013.214 341.784,2017 L326.216,2017 C327.042,2013.214 330.215,2011 334,2011 M330,2005 C330,2002.794 331.794,2001 334,2001 C336.206,2001 338,2002.794 338,2005 C338,2007.206 336.206,2009 334,2009 C331.794,2009 330,2007.206 330,2005 M337.758,2009.673 C339.124,2008.574 340,2006.89 340,2005 C340,2001.686 337.314,1999 334,1999 C330.686,1999 328,2001.686 328,2005 C328,2006.89 328.876,2008.574 330.242,2009.673 C326.583,2011.048 324,2014.445 324,2019 L344,2019 C344,2014.445 341.417,2011.048 337.758,2009.673" id="profile-[#1336]">
            
            </path>
                        </g>
                    </g>
                </g>
            </svg>
        </button>
        <div class='h-[50px]'>

        </div>
    </div>
    <div class="w-[300px]">
        <div class="px-2 py-5 mx-2">
            <h1 class="font-semibold text-xl border-b pb-5">
                Geospatial Dashboard
            </h1>
            <p class="my-2 text-gray-500">
                This dashboard is a demonstration of the capabilities of the geospatial dashboard. In this app, we can add and edit comments on the map.
            </p>
        </div>
        <!-- Tools -->
        <div class="p-2 flex flex-col">
            <button class="p-1 my-1 border-2 rounded-lg  shadow-sm text-start hover:bg-green-100/80 transition-colors active:bg-green-200/80" onclick="addCommentStateFunction()" id="addCommentButton">
                <div class="pl-2 ml-1 my-2 border-l-4 border-l-green-600">
                    <h1 class="font-semibold">
                        Add a Comment
                    </h1>
                    <p class="text-gray-600/80">
                        Click this button to add a point to the map.
                    </p>
                </div>
            </button>
            <button class="p-1 my-1 border-2 rounded-lg  shadow-sm text-start hover:bg-blue-100/80 transition-colors active:bg-blue-200/80" onclick="navigateComment()">
                <div class="pl-2 ml-1 my-2 border-l-4 border-l-blue-600">
                    <h1 class="font-semibold">
                        View Comment
                    </h1>
                    <p class="text-gray-600/80">
                        Click to navigate to the next comment.
                    </p>
                </div>
            </button>
        </div>
    </div>
    <div class="grow z-[1]">
        <div class="grow h-full w-full z-[1]" id="map"></div>
    </div>


    <div class="absolute hidden border shadow-md p-2 rounded-2xl bg-white text-gray-700 z-[99]" id="tooltip">This is the tooltip text</div>

    <script>
        let commentsArray = []
        const map = L.map('map',{
            zoomControl: false
        }).setView([51.505, -0.09], 13);

        map.attributionControl.setPrefix('<a href="https://rekayasadata.co.uk" title="Software Engineering for geospatial data.">RekayasaData.co.uk </a> | <a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>');

        map.on('load',()=>{
            
        })

        const Stadia_AlidadeSmooth = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.{ext}', {
            minZoom: 0,
            maxZoom: 20,
            attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            ext: 'png'
        }).addTo(map);

        map.on('resize', function(e) {
            map.invalidateSize()
        });

        const buttonOne = document.getElementById('buttonOne')
        buttonOne.addEventListener("mouseenter", function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = 'The first command';
            tooltip.style.display = 'block';
            tooltip.style.left = event.pageX + 12 + 'px';
            tooltip.style.top = event.pageY + 12 + 'px';
        })
        buttonOne.addEventListener("mouseleave",  function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        })
        buttonOne.addEventListener("mousemove",  function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = event.pageX + 12 + 'px';
            tooltip.style.top = event.pageY + 12 + 'px';
        })

        const buttonTwo = document.getElementById('buttonTwo')
        buttonTwo.addEventListener("mouseenter", function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = 'The second command';
            tooltip.style.display = 'block';
            tooltip.style.left = event.pageX + 12 + 'px';
            tooltip.style.top = event.pageY + 12 + 'px';
        })
        buttonTwo.addEventListener("mouseleave",  function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        })
        buttonTwo.addEventListener("mousemove",  function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = event.pageX + 12 + 'px';
            tooltip.style.top = event.pageY + 12 + 'px';
        })

        const buttonThree = document.getElementById('buttonThree')
        buttonThree.addEventListener("mouseenter", function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = 'The third command';
            tooltip.style.display = 'block';
            tooltip.style.left = event.pageX + 12 + 'px';
            tooltip.style.top = event.pageY + 12 + 'px';
        })
        buttonThree.addEventListener("mouseleave",  function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        })
        buttonThree.addEventListener("mousemove",  function(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = event.pageX + 12 + 'px';
            tooltip.style.top = event.pageY + 12 + 'px';
        })

        let addCommentState = false;
        function addCommentStateFunction(){
            addCommentState = !addCommentState;
            const addCommentButton = document.getElementById('addCommentButton')
            addCommentButton.className = addCommentState ? 'p-1 my-1 border-2 rounded-lg  shadow-sm text-start bg-green-100/80 transition-colors active:bg-green-200/80' : 'p-1 my-1 border-2 rounded-lg  shadow-sm text-start hover:bg-green-100/80 transition-colors active:bg-green-200/80'

            if (addCommentState){
                // alert ('add comment')
                map.on('mousemove', addPointOnMap)
                map.on('mouseout', removePointTooltip)
                map.on('click', addComment)
            } else {
                // alert ('end comment')
            }
        }

        const commentPoint = document.createElement('div')
        commentPoint.className = 'bg-green-500 rounded-full h-3 w-3'

        
        
        
        map.on('click', (e) => {
            console.log(commentsArray)
        })

        function addComment(e){
            // add marker
            addCommentState = !addCommentState;
            const addCommentButton = document.getElementById('addCommentButton')
            addCommentButton.className = addCommentState ? 'p-1 my-1 border-2 rounded-lg  shadow-sm text-start bg-green-100/80 transition-colors active:bg-green-200/80' : 'p-1 my-1 border-2 rounded-lg  shadow-sm text-start hover:bg-green-100/80 transition-colors active:bg-green-200/80'
            map.off('mousemove', addPointOnMap)
            map.off('mouseout', removePointTooltip)
            map.off('click', addComment)
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = 'Add a comment!';
            tooltip.style.display = 'none';
            const myIcon = L.divIcon({className: 'bg-green-500 rounded-full h-3 w-3'});
            const marker = L.marker(e.latlng, {
                icon: myIcon
            })

            let commentId = commentsArray.length

            commentsArray.push({
                commentId: commentId,
                latlng: e.latlng,
                comment: '',
                divcontent : document.createElement('div'),
                marker: marker.addTo(map).openPopup()
            })

            const index = commentsArray.findIndex(object => object.commentId === commentId);

            commentsArray[index].divcontent.innerHTML = `
                    <div class="w-full">
                        <p class="text-gray-600/80">
                            this tool is to add a comment to a map
                        </p>
                        <div class="flex flex-col">
                            <input type="text" class="border-2 border-gray-300 rounded-lg p-2 w-full my-2" placeholder="Add a comment">
                            <button class="bg-green-50 my-1 rounded-xl border p-2 hover:bg-green-100/80" onclick="setCommentContent(${index})">Save</button>
                            <button class="bg-red-50 my-1 rounded-xl border p-2 hover:bg-red-100/80" onclick="deleteCommentContent(${index})">Delete</button>
                        </div>
                    </div>
            `

            const textinput = commentsArray[index].divcontent.querySelector('input')
            

            textinput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter'){
                    setCommentContent(index)
                }
            })

            commentsArray[index].marker.bindPopup(commentsArray[index].divcontent,{
                minWidth: 300
            }).bindTooltip(commentsArray[index].comment).on('click', (e) => {
                map.setView(e.latlng, 16)
                textinput.focus()
            })

            map.setView(e.latlng, 16)
            commentsArray[index].marker.openPopup()

            textinput.focus()
        }


        function deleteCommentContent(id){
            const index = commentsArray.findIndex(object => object.commentId === id);
            commentsArray[index].marker.remove()
            delete commentsArray[index]

            commentsArray.forEach((object, index) => {
                object.commentId = index
            })
        }

        function setCommentContent(id){
            const index = commentsArray.findIndex(object => object.commentId === id);

            const theInput = commentsArray[index].divcontent.querySelector('input')

            commentsArray[index].comment = theInput.value
            const latlng = commentsArray[index].marker.getLatLng()
            commentsArray[index].marker.remove()

            delete commentsArray[index].marker

            const myIcon = L.divIcon({className: 'bg-green-500 rounded-full h-3 w-3'});

            commentsArray[index].divcontent.innerHTML = `
                    <div class="w-full">
                        <p class="text-gray-600/80">
                            ${commentsArray[index].comment}
                        </p>
                        <div class="flex flex-col">
                            <input type="text" class="border-2 border-gray-300 rounded-lg p-2 w-full my-2" placeholder="Add a comment" value="${commentsArray[index].comment}">
                            <button class="bg-green-50 my-1 rounded-xl border p-2 hover:bg-green-100/80" onclick="setCommentContent(${index})">Save</button>
                            <button class="bg-red-50 my-1 rounded-xl border p-2 hover:bg-red-100/80" onclick="deleteCommentContent(${index})">Delete</button>
                        </div>
                    </div>
            `

            const textinput = commentsArray[index].divcontent.querySelector('input')

            commentsArray[index].marker = L.marker(latlng, {
                icon: myIcon
            }).bindPopup(commentsArray[index].divcontent,{
                minWidth: 300
            }).bindTooltip(commentsArray[index].comment).on('click', (e) => {
                map.setView(latlng, 16)
                textinput.focus()
            })
            commentsArray[index].marker.addTo(map)
            textinput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter'){
                    setCommentContent(index)
                }
            })

            setTimeout(() => {
                commentsArray[index].marker.openPopup()
                textinput.focus()
            }, 100);

            

        }

        /**
         * 
         * @param {MouseEvent} e 
         */
        function addPointOnMap(e){
            // console.log(e.originalEvent.pageX, e.originalEvent.pageY)
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = 'Click to add a comment!';
            tooltip.style.display = 'block';
            tooltip.style.left = e.originalEvent.pageX + 12 + 'px';
            tooltip.style.top = e.originalEvent.pageY + 12 + 'px';
        }

        function removePointTooltip(e){
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = 'Add a comment!';
            tooltip.style.display = 'none';
        }



        let navigateCommentIndex = 0
        function navigateComment(){
            
            if (commentsArray.length > 0){
                
                if (navigateCommentIndex < commentsArray.length - 1){
                    navigateCommentIndex++
                } else {
                    navigateCommentIndex = 0
                }

                let index = commentsArray.findIndex(object => object.commentId === navigateCommentIndex);

                if (!map.hasLayer(commentsArray[index].marker)){
                    if (navigateCommentIndex < commentsArray.length - 1){
                        navigateCommentIndex++
                    } else {
                        navigateCommentIndex = 0
                    }
            
                } 
                index = commentsArray.findIndex(object => object.commentId === navigateCommentIndex);
                map.flyTo(commentsArray[index].latlng, 16)
                commentsArray[index].marker.openPopup()
            }
        }
    </script>
</body>
</html>